// Copyright (c) 2013-2015 Sandstorm Development Group, Inc. and contributors
// Licensed under the MIT License:
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.


// use gj::{Promise, EventLoop};

use gj;
// use gj::{EventLoop, Promise};
// use gj::io::{AsyncRead, AsyncWrite, unix};
use std::time::Duration;
use capnp_rpc::{RpcSystem, twoparty, rpc_twoparty_capnp};
use std::net::ToSocketAddrs;
use feature_capnp::feature;
use capnp::{primitive_list, message};


pub fn main() {

  gj::EventLoop::top_level(|wait_scope| {
    let addr1 = try!("127.0.0.1:6001".to_socket_addrs()).next().expect("couldn't parse");
    let addr2 = try!("127.0.0.1:6002".to_socket_addrs()).next().expect("couldn't parse");

    let (reader1, writer1) = try!(::gj::io::tcp::Stream::connect(addr1).wait(wait_scope)).split();
    let network1 =
        Box::new(twoparty::VatNetwork::new(reader1, writer1,
                                           rpc_twoparty_capnp::Side::Client,
                                           Default::default()));
    let mut rpc_system1 = RpcSystem::new(network1, None);
    let feature1: feature::Client = rpc_system1.bootstrap(rpc_twoparty_capnp::Side::Server);

    // let (reader2, writer2) = try!(::gj::io::tcp::Stream::connect(addr2).wait(wait_scope)).split();
    // let network2 =
    //     Box::new(twoparty::VatNetwork::new(reader2, writer2,
    //                                        rpc_twoparty_capnp::Side::Client,
    //                                        Default::default()));
    // let mut rpc_system2 = RpcSystem::new(network2, None);
    // let feature2: feature::Client = rpc_system2.bootstrap(rpc_twoparty_capnp::Side::Server);
    // let feature_vec = [2u8,3u8,4u8];
    
    // let feature_vec = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.004418077994211196, -0.005754819608582749, -0.004082516925754767, -0.004082516925754767, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.004082516925754767, -0.004709688274805744, -0.008799346401364075, -0.011590559124901078, -0.014758979800687548, -0.019284854648110316, -0.02467179747666586, -0.02907102711811289, -0.030592658308098594, -0.031164012749625037, -0.031962871942047555, -0.03020253552305767, -0.03131021751269332, -0.028383396028899912, -0.023119190632164905, -0.019166625980513538, -0.016772300785307448, -0.010996360135763427, -0.008324860798174898, -0.004380693556572798, 0, 0, 0, 0, 0, 0, -0.004082516925754767, -0.005395345980050576, -0.008522412350213183, -0.011985036306279614, -0.017653477749775714, -0.027710898932479657, -0.03702009432499074, -0.052151280221332814, -0.06703620073066842, -0.08301704836208494, -0.09937929783557269, -0.1151841277778927, -0.1291332561545409, -0.13839467726744728, -0.1388836307617482, -0.1318434382266132, -0.12042952234827012, -0.10189079484830871, -0.07860490436395196, -0.05699561304034144, -0.03965768387975508, -0.023728386125155435, -0.01408834633843315, -0.00783084068293268, 0, 0, 0, 0, -0.005368377534929676, -0.008870605892368487, -0.014070817027444013, -0.022146809806048974, -0.035180136797917726, -0.05502368019943979, -0.07909613213552497, -0.10764901248535225, -0.13716993570650834, -0.1671057614119199, -0.19600875548259125, -0.22449111368547134, -0.2486559914175255, -0.2621179706346261, -0.2625969016466672, -0.24785590321914444, -0.22194700322681934, -0.18721140499215858, -0.14764013164625323, -0.10816436385538704, -0.07681211165410817, -0.04707529960456195, -0.030201967580920606, -0.015241243556148313, -0.005283719648356601, 0, 0, -0.004082516925754766, -0.007763423021257878, -0.014893254767559455, -0.023962750468679763, -0.050340898033052556, -0.07876747026307597, -0.11618154027353761, -0.16124756197962478, -0.2119616353497665, -0.2668987312105934, -0.3256780103275002, -0.39024154804428063, -0.4520763757771982, -0.49939798378235856, -0.5234283239750624, -0.5176188944070836, -0.4809024190689775, -0.4230796940210919, -0.3567403949049612, -0.28368364842044325, -0.21683666135332633, -0.1585243802689142, -0.10878458131852733, -0.0709225308761024, -0.038953481864410604, -0.014252385154959166, -0.005770498064545266, 0, 0, -0.011901740561710412, -0.02205015595894775, -0.0518380749926103, -0.09065970354797098, -0.13966710556553794, -0.19708212055276852, -0.2643847276645999, -0.34073044164379185, -0.42253574910981867, -0.5154086485436498, -0.6160353269312437, -0.7159832968261344, -0.7941204659817066, -0.8350492526384127, -0.8241858113176772, -0.7628392835027732, -0.6665594982839844, -0.5562503979004713, -0.4476456540268804, -0.3476246140922326, -0.2608409066724363, -0.19030605326636274, -0.1310801296726393, -0.07484603738343984, -0.031930129109272974, -0.008208918339699315, 0, -0.005570152928413006, -0.015661927086085867, -0.03636566063316357, -0.0790243079312138, -0.13328908621586852, -0.19915441070732662, -0.2754296914641389, -0.36333594608959097, -0.4630805329889938, -0.5748451889692174, -0.6988038728073873, -0.8287736835249182, -0.9568920476699974, -1.0564726393771116, -1.1047183078736826, -1.0835076091183173, -0.9989516457473737, -0.8747476236339511, -0.7245597345971897, -0.5806058982029311, -0.4521587638295923, -0.3393234310712335, -0.24893037280300365, -0.17293970156995084, -0.10410424039345649, -0.04831762200945975, -0.014708018279628208, -0.004082516925754767, -0.013231009292606188, -0.026243820940936934, -0.05915859084502297, -0.11300485291708952, -0.1784415250878012, -0.2580048101164379, -0.3509118116185077, -0.4590982241743866, -0.5841455569295048, -0.7249542068060381, -0.8756392662371509, -1.0148029044892124, -1.132168566222885, -1.2021883425077196, -1.2295375038647798, -1.2096976992530377, -1.14460982747982, -1.02312554206095, -0.8629535839997374, -0.6904802385139607, -0.5329013200623868, -0.39754744006276055, -0.2876812788910055, -0.19700702540851978, -0.12122893967131874, -0.0568086109128652, -0.015390667951263948, -0.005025492982118831, -0.017320519180300704, -0.04308053913866349, -0.08524889694769125, -0.13945836882493945, -0.2108833075512938, 0.3421826081381143, 2.647598254176329, 2.3512632627447183, 1.8577274842403226, 1.5266215658007125, 1.317978136786221, 1.211106341689559, 1.1817207870797148, 1.1778576909122462, 1.0618954041689543, -0.042703576976234905, -0.03732768718609281, 0.015613280848688285, 0.5570705531973066, 0.6566270633687978, -0.19319644219087678, -0.42367100161696564, -0.2981962066954985, -0.19768613533173734, -0.12068381546044689, -0.05393562849624329, -0.01350554337905923, -0.005905712612600255, -0.021109667901146024, -0.05298903688184829, -0.0930784923568592, -0.15039873374962087, -0.22619102328598759, 3.0410160235996044, 2.7997117702486465, 2.1179861557859874, 1.6752072549153953, 1.399799773169122, 1.2777120263641812, 1.2773453862644573, 1.3481909791687672, 1.4127447533800865, 1.4125512190670926, 1.3598107575969547, 1.2856613308060012, 1.2770172606066845, 1.3989328587969683, 1.682569430145565, 0.24008703031262682, -0.420171899207801, -0.2901745954224208, -0.18148235125157422, -0.10493977495234405, -0.04721317293318761, -0.014130865617771427, -0.005772805186741252, -0.02263227713811364, -0.05280317468401204, -0.09220580674094482, -0.1474516998370939, -0.22728458804171867, 3.1149712510073675, 2.6850632083660053, 2.0036772704995354, 0.40062282104502733, 0.1066925209805737, 0.13389087828599588, -0.49911908966668456, -0.4127159646341486, -0.3829031205379669, 0.42281354260931114, 0.7739736689946773, 0.9984576095131033, 1.3282005993339638, 1.4550833801956893, 1.768228144042575, 0.2967722330740306, -0.3967710269391994, -0.2712226416933548, -0.1593244643532399, -0.0812584087008027, -0.03695086704276008, -0.011873399189204705, -0.007055173963740039, -0.020771176849707335, -0.04720356239979033, -0.0820038362326476, -0.13745728492178425, -0.22518195549159836, 1.4073677509603044, 2.5827791168831884, 1.910908599846343, 0.14662475261758312, -0.8964604606189358, -0.871785592654991, -0.7849760955663464, -0.7325417373526399, -0.7409505594572422, -0.8022104697847319, -0.9012628148195432, -0.7048258041318276, 1.2542421265855137, 1.5192687903529178, 1.1217473949114998, -0.2878532555487705, -0.3695733091085306, -0.25846440689370354, -0.14969571472681045, -0.06111135638789351, -0.0280115688080757, -0.009125099649816424, -0.005304351295178483, -0.01623839990117254, -0.036378614816852714, -0.06858201047084002, -0.12736849891403002, -0.22614335961635912, 0.8229415517539157, 2.4394854595556406, 1.8129011750630029, 0.9611890086177253, -0.8888300357412906, -0.8419009114388921, -0.7665345278953433, -0.7702047547957347, -0.820343719517538, -0.9176834904474621, -1.0290959404025217, -0.2932435041682214, 1.2726223899175262, 1.480321117934288, -0.12197855044694292, -0.47007288390074886, -0.3551244144324662, -0.2554075446449821, -0.15382451343799078, -0.0524542820536055, -0.021505865070045687, -0.009921981611123705, -0.004082516925754767, -0.010934385379308176, -0.025544797876397993, -0.057073080970823024, -0.12466202029939262, -0.23849817291840633, 0.07955147988051238, 1.8981689008351406, 1.743511746454151, 1.3458442983332268, -0.8800742493167523, -0.8410142726675089, -0.8167909585107296, -0.8919240373048258, -0.9785505634606445, -1.1108034291517508, -1.1351534400354857, 0.6634109283161163, 1.2919775154185518, 0.8485978547170313, -0.5944466048581845, -0.46091023791539754, -0.35550054572089246, -0.2635491803803216, -0.164503687130654, -0.0595130325227715, -0.023368667891515357, -0.007404323760897924, -0.0040825169257547676, -0.007988345429346335, -0.01829645295877684, -0.05133943453236294, -0.12934639719891805, -0.25752139340050234, -0.39501132961156366, 0.7790892565475988, 1.7191344713840222, 1.3586098091308727, -0.8678531507110178, -0.8607437221141545, -0.9040356797027784, -1.0347035295982636, -1.1454361823194157, -1.2742078920823614, -1.18446404145531, 1.1115533991691717, 1.3145034862041327, 0.8674787312771643, -0.5970270400242025, -0.4720199894529292, -0.3683704120710684, -0.27332531634520335, -0.1733866336277272, -0.06894271985394718, -0.024644657314558623, -0.006984901928106622, -0.0047702800621167865, -0.004189428022539024, -0.018648256381970412, -0.05327212370490518, -0.14042051677981554, -0.27718062364316937, -0.41220900758168094, 0.051823831552510746, 1.7586708597112894, 1.472409844229923, -0.34441083988565546, -0.8697669826071899, -0.9586643469179289, -1.0941026571060875, -1.2048945535106517, -1.2724254103359656, 0.08257765876095173, 1.1682787129767649, 1.3806836327744016, 0.8796061635578627, -0.6097871833223789, -0.4867539386884951, -0.380896776529848, -0.2782988904575992, -0.17549155193650756, -0.07702614253864604, -0.02962630399965664, -0.00911024024464759, -0.004082516925754767, -0.006707277369386546, -0.021601432335573118, -0.06070769227751002, -0.1570224115275366, -0.29716316829999756, -0.42230679805745347, -0.48016703672559646, 1.1299960878950606, 1.666573031536299, 1.4720166090010771, -0.787350073805526, -0.9194133975352892, -1.0259556200619724, -1.122775514498137, -1.1450631619152503, 0.20458362056072546, 1.2746646570781692, 1.4526406465501864, 0.4387709525058792, -0.6156216426375579, -0.49307976460795283, -0.37987428084700636, -0.27351764929762656, -0.17353912085962375, -0.08405014822137534, -0.03416244221805137, -0.008939647479153563, 0, -0.00893208845374742, -0.025397763430053854, -0.07390017569495518, -0.17786004742175898, -0.31338342960570287, -0.4290130612715982, -0.5350889361368117, 1.1452378598936375, 1.8126197004474973, 1.7274467420259725, 0.35333688275483155, -0.8250704248196153, -0.9193902354477618, -1.0062601332296954, -1.0328150547988861, 0.28592923786290464, 1.3516125382454556, 1.4811509832291796, -0.4145323928234594, -0.6132657942616707, -0.48515629201913274, -0.36804197776930747, -0.2607818239949698, -0.1683337567686281, -0.0885426370285746, -0.03593623389940792, -0.010710812855630579, -0.00590596678419834, -0.006352114144594117, -0.03332021409440274, -0.0913048629851414, -0.1991080306597362, -0.3279674124630514, -0.43899542662547636, -0.5344540881140795, 0.06990560749963254, 1.6786817150589457, 1.7629728376539886, 0.6334579597423521, -0.7811256669249281, -0.871688551911598, -0.958454454084227, -0.9571699199385195, 0.48687629043667097, 1.3427990226064865, 0.7648233323075266, -0.6463003887445613, -0.5949105954406912, -0.46342915009115865, -0.34877114414893734, -0.24588474663859947, -0.15820093566860097, -0.08543796267169584, -0.03155796156376426, -0.009760414118972039, -0.004082516925754767, -0.01128166266784826, -0.03975710162976513, -0.10385233479292914, -0.21198097145090775, -0.3374778885504181, -0.45170193276974174, -0.5521316096061931, -0.631886475050879, -0.17771841552207437, 0.10542612929875131, -0.3043824422808461, -0.82876952328269, -0.91927271014272, -1.0088060986882783, -0.6736102818395849, 1.2393567964166823, 1.3103279713729459, -0.28692162134811006, -0.7012227544912044, -0.5553856544365151, -0.42707460646741957, -0.3168104798225877, -0.22068580332366872, -0.14105726370130064, -0.0781710423453571, -0.02918257849249846, -0.008025785967993797, 0, -0.010342104899698654, -0.043273622028637805, -0.10916701376363136, -0.20903257268663047, -0.33022464068133384, -0.4548752656979406, -0.5691968071839147, -0.6729436000650583, -0.7606012256291991, -0.8287574951433705, -0.8865081899328614, -0.9598404033756216, -1.051383968549311, -1.120904824641432, 0.3546657740738812, 1.2116777354357728, 1.3500492710249294, -0.6653165720437914, -0.6269909558558485, -0.48806277491330047, -0.36895114434919407, -0.2692922257818171, -0.1872126234743825, -0.12162743363810283, -0.0664938196525457, -0.026033003065103984, -0.005773315938908735, -0.004082516925754767, -0.01000950354844865, -0.040498731456984974, -0.09998470793293325, -0.1882017241789133, -0.2996313123726242, -0.4272484689446661, -0.5552513604737971, -0.6817773973840882, -0.8015875159851062, -0.9086568458654274, -1.0089452370233423, -1.1036228854408647, -1.1813322012848917, -1.192185678616148, 0.36166746212525935, 1.2925838717722822, 1.5212298479694157, -0.5368891241186318, -0.5226944923029817, -0.3990654281044612, -0.2967006429141043, -0.2126262236852827, -0.14869395756610573, -0.09689572841653776, -0.05093108885438537, -0.02021442934674059, -0.004082516925754767, -0.0040825169257547676, -0.006004905736525743, -0.03370634708032948, -0.07897245047642618, -0.14774137678937121, -0.2432502498459741, -0.36034629759351816, -0.48644317204398224, -0.6224099815114671, -0.7567041759365316, -0.8887365126330002, -1.0021705916762689, -1.0895925700834848, -1.11743802268651, -0.6649138818501064, 1.2742100672435621, 1.5409967408991876, 1.8842325417912544, -0.37344776035967286, -0.402142028444983, -0.3030691596217147, -0.22168084444305053, -0.1593659352678555, -0.11006069947430872, -0.07003976496274049, -0.03713562282817449, -0.0122014098676475, -0.004082516925754767, 0, 0, -0.02273872664707431, -0.05190539722587407, -0.09998802418062412, -0.1684316226332373, -0.26031071981245063, -0.3698370806113162, -0.4900979951208916, -0.6153706792130447, -0.7389779935920433, -0.8431759046423057, -0.9019514135354619, -0.8998060832371203, -0.3855403161546829, 1.724450621777844, 2.0787259250427583, 1.2830862307049997, -0.35012664564005613, -0.2888173933136608, -0.2134409370971954, -0.15366778231001735, -0.10912600801168756, -0.07409875615449375, -0.04331718511626431, -0.019343791974134238, -0.010402482001507098, 0, 0, 0, -0.010352700832243766, -0.028750102390248028, -0.057568373617723476, -0.09531053678838, -0.15360976204178156, -0.22342452610552213, -0.30357777033971306, -0.3884799734831808, -0.47019583239547175, -0.5331235654070015, -0.5665059886612528, -0.5627836560393308, 0.04133098989451093, 2.754694685980215, 3.253326471950371, 1.8678293265460466, -0.25570503161948915, -0.19461171231865995, -0.14457420509781935, -0.10177354277104227, -0.07142522268115532, -0.04777775685669172, -0.025752435925905506, -0.011379423743751067, -0.004752874917870337, 0, 0, 0, -0.006664301110442401, -0.010964213203956, -0.027604451585167823, -0.05155360119059275, -0.0867718458342109, -0.1283920327524358, -0.1757758980476885, -0.22305443764921437, -0.26664028561813097, -0.29484431541339895, -0.30750543293969684, -0.30518012168766356, 0.6073178177125922, 4.811425844768786, 5.398948012298321, 3.12743252239977, -0.16369105191188496, -0.1276659960926563, -0.09396513933164433, -0.06568325906042519, -0.04592653104986374, -0.02871880965657705, -0.01569303650878044, -0.005675306155421161, -0.004082516925754767, 0, 0, 0, 0, -0.004082516925754766, -0.015121393856472593, -0.03136955454304035, -0.053330234885471194, -0.07922826691499778, -0.10837665033583997, -0.13397906785967686, -0.15751318066969955, -0.17510551348168438, -0.18262689734335766, -0.18053534074685537, 1.3244100458353982, 8.552938342478281, 9.557700256833241, 5.680981686914348, -0.09395125413644236, -0.07257688709808616, -0.05236435966672351, -0.03638299951427373, -0.02150306373103313, -0.013019279127544239, -0.004494215165141858, -0.004082516925754767, 0, 0, 0, 0, 0, 0, -0.0057901636256605, -0.00905384592331612, -0.016005442979134005, -0.02211976011195992, -0.026845995824700646, -0.0318450632443541, -0.04374840874334269, -0.04728294737239925, -0.05313880455092308, -0.05662281938629993, 1.9566891804550037, 12.304391047988144, 26.444147700370536, 7.4036928473079096, -0.033171027081821514, -0.022462882975751206, -0.0160690869725976, -0.011432202800698484, -0.009007294500051851, -0.005770393928137421, 0, 0, 0, 0];
    
    let feature_vec = vec![0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-0.00441807799421,-0.00575481960858,-0.00408251692575,-0.00408251692575,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-0.00408251692575,-0.00470968827481,-0.00879934640136,-0.0115905591249,-0.0147589798007,-0.0192848546481,-0.0246717974767,-0.0290710271181,-0.0305926583081,-0.0311640127496,-0.031962871942,-0.0302025355231,-0.0313102175127,-0.0283833960289,-0.0231191906322,-0.0191666259805,-0.0167723007853,-0.0109963601358,-0.00832486079817,-0.00438069355657,0.0,0.0,0.0,0.0,0.0,0.0,-0.00408251692575,-0.00539534598005,-0.00852241235021,-0.0119850363063,-0.0176534777498,-0.0277108989325,-0.037020094325,-0.0521512802213,-0.0670362007307,-0.0830170483621,-0.0993792978356,-0.115184127778,-0.129133256155,-0.138394677267,-0.138883630762,-0.131843438227,-0.120429522348,-0.101890794848,-0.078604904364,-0.0569956130403,-0.0396576838798,-0.0237283861252,-0.0140883463384,-0.00783084068293,0.0,0.0,0.0,0.0,-0.00536837753493,-0.00887060589237,-0.0140708170274,-0.022146809806,-0.0351801367979,-0.0550236801994,-0.0790961321355,-0.107649012485,-0.137169935707,-0.167105761412,-0.196008755483,-0.224491113685,-0.248655991418,-0.262117970635,-0.262596901647,-0.247855903219,-0.221947003227,-0.187211404992,-0.147640131646,-0.108164363855,-0.0768121116541,-0.0470752996046,-0.0302019675809,-0.0152412435561,-0.00528371964836,0.0,0.0,-0.00408251692575,-0.00776342302126,-0.0148932547676,-0.0239627504687,-0.0503408980331,-0.0787674702631,-0.116181540274,-0.16124756198,-0.21196163535,-0.266898731211,-0.325678010328,-0.390241548044,-0.452076375777,-0.499397983782,0.0664790962114,1.33857347746,2.62752386622,1.72417535293,0.421355557735,-0.28368364842,-0.216836661353,-0.158524380269,-0.108784581319,-0.0709225308761,-0.0389534818644,-0.014252385155,-0.00577049806455,0.0,0.0,-0.0119017405617,-0.0220501559589,-0.0518380749926,-0.090659703548,-0.139667105566,-0.197082120553,-0.264384727665,-0.340730441644,-0.42253574911,-0.515408648544,-0.616035326931,-0.715983296826,-0.346217315588,1.35857323536,1.51146013535,1.63467259668,1.88069283424,2.09129319289,-0.447645654027,-0.347624614092,-0.260840906672,-0.190306053266,-0.131080129673,-0.0748460373834,-0.0319301291093,-0.0082089183397,0.0,-0.00557015292841,-0.0156619270861,-0.0363656606332,-0.0790243079312,-0.133289086216,-0.199154410707,-0.275429691464,-0.36333594609,-0.463080532989,-0.574845188969,-0.698803872807,-0.828773683525,-0.4704877591,0.967214372604,1.14748071276,1.15986537859,1.13210556937,1.24594939318,1.70460493546,0.0318349246802,-0.375331751768,-0.339323431071,-0.248930372803,-0.17293970157,-0.104104240393,-0.0483176220095,-0.0147080182796,-0.00408251692575,-0.0132310092926,-0.0262438209409,-0.059158590845,-0.113004852917,-0.178441525088,-0.258004810116,-0.350911811619,-0.459098224174,-0.58414555693,-0.724954206806,-0.782588195516,-0.469109624234,0.896678857013,1.07977518601,1.0679216924,1.07653978862,0.68058505173,-0.26623370141,1.45680751607,1.81305479038,0.85531047516,-0.397547440063,-0.287681278891,-0.197007025409,-0.121228939671,-0.0568086109129,-0.0153906679513,-0.00502549298212,-0.0173205191803,-0.0430805391387,-0.0852488969477,-0.139458368825,-0.210883307551,-0.300017977293,-0.407281526176,-0.532888479951,-0.680629425364,-0.841988502556,0.493813209117,1.19310596876,1.15478312223,1.15986990605,1.17922258857,1.16706784506,1.16966782039,-0.181901964113,0.802078729468,1.67958984662,1.2316834506,-0.423671001617,-0.298196206695,-0.197686135332,-0.12068381546,-0.0539356284962,-0.0135055433791,-0.0059057126126,-0.0211096679011,-0.0529890368818,-0.0930784923569,-0.15039873375,-0.226191023286,-0.323645340102,-0.442131217165,-0.584247477215,-0.748575592624,-0.436762753779,1.14312113307,1.27734538626,1.34819097917,0.834626528424,0.134362604749,1.3598107576,1.05950033538,-0.576578728579,-0.1831889431,1.70169394355,1.2416058305,-0.420171899208,-0.290174595422,-0.181482351252,-0.104939774952,-0.0472131729332,-0.0141308656178,-0.00577280518674,-0.0226322771381,-0.052803174684,-0.0922058067409,-0.147451699837,-0.227284588042,-0.332428316391,-0.462696158126,-0.619033521436,-0.33289011147,1.24845772117,1.343597298,1.46430748977,0.922877915724,-0.654859407505,-0.090552165249,0.252600075213,-0.760217032925,-0.962131065451,-0.86347325894,1.76822814404,2.1653103394,0.299851756711,-0.271222641693,-0.159324464353,-0.0812584087008,-0.0369508670428,-0.0118733991892,-0.00705517396374,-0.0207711768497,-0.0472035623998,-0.0820038362326,-0.137457284922,-0.225181955492,-0.338492381081,-0.482934997028,-0.26390292609,0.722339936736,1.39958283942,1.26938430061,1.21389713157,0.10644360141,-0.740950559457,-0.802210469785,-0.90126281482,-0.977722927773,-0.955547942535,-0.824902898819,1.89950655807,2.46178884716,2.03677827006,-0.258464406894,-0.149695714727,-0.0611113563879,-0.0280115688081,-0.00912509964982,-0.00530435129518,-0.0162383999012,-0.0363786148169,-0.0685820104708,-0.127368498914,-0.226143359616,-0.352202906319,-0.426044054917,1.07406200075,1.48425610209,1.2902576313,-0.185629821139,-0.583812788143,-0.498490339416,-0.820343719518,-0.917683490447,-1.0290959404,-1.05827899574,-0.965674043057,-0.794476763378,2.04659139551,2.62578927027,2.56195634559,-0.255407544645,-0.153824513438,-0.0524542820536,-0.02150586507,-0.00992198161112,-0.00408251692575,-0.0109343853793,-0.0255447978764,-0.0570730809708,-0.124662020299,-0.238498172918,-0.373258897318,0.105501642659,1.73384532003,1.46460089468,-0.307821346292,-0.841014272668,-0.816790958511,-0.891924037305,-0.978550563461,-1.11080342915,-1.18062995709,-1.12885775543,-0.976070412814,-0.775195395221,2.128824212,2.66099887963,2.53621867004,-0.26354918038,-0.164503687131,-0.0595130325228,-0.0233686678915,-0.0074043237609,-0.00408251692575,-0.00798834542935,-0.0182964529588,-0.0513394345324,-0.129346397199,-0.257521393401,-0.395011329612,1.60730921098,1.71913447138,0.910708881582,-0.867853150711,-0.860743722114,-0.904035679703,-1.0347035296,-1.14543618232,-1.27420789208,-1.24819354129,-1.13977509209,-0.963283446293,-0.763011315741,2.11689832569,2.59453504982,2.45887168317,-0.273325316345,-0.173386633628,-0.0689427198539,-0.0246446573146,-0.00698490192811,-0.00477028006212,-0.00418942802254,-0.018648256382,-0.0532721237049,-0.14042051678,-0.277180623643,0.598748925797,2.1073090752,1.74898439211,0.242842224313,-0.841940835592,-0.869766982607,-0.958664346918,-1.09410265711,-1.20489455351,-1.27242541034,-1.18363406277,-1.07835248913,-0.922584533336,-0.752481273036,2.03723548337,2.48680284264,1.70852053856,-0.278298890458,-0.175491551937,-0.0770261425386,-0.0296263039997,-0.00911024024465,-0.00408251692575,-0.00670727736939,-0.0216014323356,-0.0607076922775,-0.157022411528,-0.2971631683,0.680324739981,2.20777943774,1.62696730373,-0.503323320722,-0.788379564724,-0.833967293221,-0.919413397535,-1.02595562006,-1.1227755145,-1.14506316192,-1.07945970214,-0.999886313397,-0.814408067728,0.554122610677,1.99735006533,1.68846421816,-0.209328014085,-0.273517649298,-0.17353912086,-0.0840501482214,-0.0341624422181,-0.00893964747915,0.0,-0.00893208845375,-0.0253977634301,-0.073900175695,-0.177860047422,-0.313383429606,0.661115550201,2.26384481261,1.66888327976,-0.682689238351,-0.723470136983,-0.765558978993,-0.82507042482,-0.919390235448,-1.00626013323,-1.0328150548,-1.01067268788,-0.887786558701,0.354403023937,1.67434793842,1.71250959102,0.358939069301,-0.368041977769,-0.260781823995,-0.168333756769,-0.0885426370286,-0.0359362338994,-0.0107108128556,-0.0059059667842,-0.00635211414459,-0.0333202140944,-0.0913048629851,-0.19910803066,-0.327967412463,0.629859358561,2.26079821001,0.901725305107,-0.65940509393,-0.697848365997,-0.730422894197,-0.781125666925,-0.871688551912,-0.958454454084,-1.01124661216,-0.574863350182,0.544279336181,1.45276738766,0.921011255802,-0.594910595441,-0.463429150091,-0.348771144149,-0.245884746639,-0.158200935669,-0.0854379626717,-0.0315579615638,-0.00976041411897,-0.00408251692575,-0.0112816626678,-0.0397571016298,-0.103852334793,-0.211980971451,-0.33747788855,0.602955315947,2.18799892561,1.64837198281,-0.693224390998,-0.738384900458,-0.770730766579,-0.828769523283,-0.919272710143,-1.00880609869,-0.0342503323906,1.10373542156,1.31032797137,0.639597181306,-0.701222754491,-0.555385654437,-0.427074606467,-0.316810479823,-0.220685803324,-0.141057263701,-0.0781710423454,-0.0291825784925,-0.00802578596799,0.0,-0.0103421048997,-0.0432736220286,-0.109167013764,-0.209032572687,-0.330224640681,0.587707225645,2.09722521999,1.76010668223,0.607663020891,-0.38873806684,-0.623869419154,-0.195454161553,0.543529251806,0.897492196179,1.14592402131,0.941984007052,0.571840310835,-0.261675595284,-0.626990955856,-0.488062774913,-0.368951144349,-0.269292225782,-0.187212623474,-0.121627433638,-0.0664938196525,-0.0260330030651,-0.00577331593891,-0.00408251692575,-0.0100095035484,-0.040498731457,-0.0999847079329,-0.188201724179,-0.299631312373,0.679630842117,2.15797233855,1.75785333516,1.5135462807,1.15186841003,0.920019942258,1.16494627073,1.10209544956,1.0864825976,0.641038055124,0.180580333875,-0.832232744129,-0.66712599008,-0.522694492303,-0.399065428104,-0.296700642914,-0.212626223685,-0.148693957566,-0.0968957284165,-0.0509310888544,-0.0202144293467,-0.00408251692575,-0.00408251692575,-0.00600490573653,-0.0337063470803,-0.0789724504764,-0.147741376789,-0.243250249846,0.0710099717658,1.8955864756,1.9501571215,1.59732965805,1.3799254382,1.23077257924,1.151410156,0.960442137374,0.217318093432,-0.963072630087,-0.817668172676,-0.664655910238,-0.523595079789,-0.402142028445,-0.303069159622,-0.221680844443,-0.159365935268,-0.110060699474,-0.0700397649627,-0.0371356228282,-0.0122014098676,-0.00408251692575,0.0,0.0,-0.0227387266471,-0.0519053972259,-0.0999880241806,-0.168431622633,-0.260310719812,0.0163732585938,1.06821963099,2.01779067491,1.68064378222,1.46558481139,0.373570735609,-0.564073344966,-0.83974857906,-0.734655534131,-0.612575710848,-0.492071187961,-0.379928166583,-0.288817393314,-0.213440937097,-0.15366778231,-0.109126008012,-0.0740987561545,-0.0433171851163,-0.0193437919741,-0.0104024820015,0.0,0.0,0.0,-0.0103527008322,-0.0287501023902,-0.0575683736177,-0.0953105367884,-0.153609762042,-0.223424526106,-0.30357777034,-0.388479973483,-0.470195832395,-0.533123565407,-0.566505988661,-0.562783656039,-0.527164695571,-0.468057396524,-0.395805045257,-0.324789445995,-0.255705031619,-0.194611712319,-0.144574205098,-0.101773542771,-0.0714252226812,-0.0477777568567,-0.0257524359259,-0.0113794237438,-0.00475287491787,0.0,0.0,0.0,-0.00666430111044,-0.010964213204,-0.0276044515852,-0.0515536011906,-0.0867718458342,-0.128392032752,-0.175775898048,-0.223054437649,-0.266640285618,-0.294844315413,-0.30750543294,-0.305180121688,-0.28923177912,-0.26323129113,-0.233723589359,-0.201027824051,-0.163691051912,-0.127665996093,-0.0939651393316,-0.0656832590604,-0.0459265310499,-0.0287188096566,-0.0156930365088,-0.00567530615542,-0.00408251692575,0.0,0.0,0.0,0.0,-0.00408251692575,-0.0151213938565,-0.031369554543,-0.0533302348855,-0.079228266915,-0.108376650336,-0.13397906786,-0.15751318067,-0.175105513482,-0.182626897343,-0.180535340747,-0.169876490982,-0.153157313608,-0.135433123681,-0.116480299225,-0.0939512541364,-0.0725768870981,-0.0523643596667,-0.0363829995143,-0.021503063731,-0.0130192791275,-0.00449421516514,-0.00408251692575,0.0,0.0,0.0,0.0,0.0,0.0,-0.00579016362566,-0.00905384592332,-0.0160054429791,-0.022119760112,-0.0268459958247,-0.0318450632444,-0.0437484087433,-0.0472829473724,-0.0531388045509,-0.0566228193863,-0.0603383556115,-0.0562950014384,-0.0513665377774,-0.0426322797762,-0.0331710270818,-0.0224628829758,-0.0160690869726,-0.0114322028007,-0.00900729450005,-0.00577039392814,0.0,0.0,0.0,0.0];
    // let mut message: message::Builder<message::HeapAllocator> = message::Builder::new_default();

    // let feature_list = primitive_list::
    println!("{}", feature_vec.len());

    let predict1 = {
        let mut request = feature1.compute_feature_request();

        {
          let mut builder = request.get();
          let mut inp_entries = builder.init_inp(feature_vec.len() as u32);
          for i in 0..feature_vec.len() {
            inp_entries.set(i as u32, feature_vec[i]);
          }
        }

        // request.get().set_inp(message.get_root::<primitive_list::Builder>().as_reader());
        let predict_promise = request.send();
        // let read_promise = predict_promise.pipeline.get_value().read_request().send();

        let response = try!(predict_promise.promise.wait(wait_scope));

        try!(response.get()).get_result()
    };
    println!("got a response: {}", predict1);

    // let predict2 = {
    //     let mut request = feature2.compute_feature_request();
    //     request.get().set_input(&[127,128,255,12,255]);
    //     let predict_promise = request.send();
    //     // let read_promise = predict_promise.pipeline.get_value().read_request().send();
    //
    //     let response = try!(predict_promise.promise.wait(wait_scope));
    //
    //     try!(response.get()).get_result()
    // };
    // println!("got a response: {}", predict2);

    // let add = {
    //     // Get the "add" function from the server.
    //     let mut request = calculator1.get_operator_request();
    //     request.get().set_op(calculator::Operator::Add);
    //     request.send().pipeline.get_func()
    // };
    //
    // let subtract = {
    //     // Get the "subtract" function from the server.
    //     let mut request = calculator.get_operator_request();
    //     request.get().set_op(calculator::Operator::Subtract);
    //     request.send().pipeline.get_func()
    // };
    //
    // // Build the request to evaluate 123 + 45 - 67.
    // let mut request = calculator.evaluate_request();
    //
    // {
    //     let mut subtract_call = request.get().init_expression().init_call();
    //     subtract_call.set_function(subtract);
    //     let mut subtract_params = subtract_call.init_params(2);
    //     subtract_params.borrow().get(1).set_literal(67.0);
    //
    //     let mut add_call = subtract_params.get(0).init_call();
    //     add_call.set_function(add);
    //     let mut add_params = add_call.init_params(2);
    //     add_params.borrow().get(0).set_literal(123.0);
    //     add_params.get(1).set_literal(45.0);
    // }
    //
    // // Send the evaluate() request, read() the result, and wait for read() to
    // // finish.
    // let eval_promise = request.send();
    // let read_promise = eval_promise.pipeline.get_value().read_request().send();
    //
    // let response = try!(read_promise.promise.wait(wait_scope));
    // assert_eq!(try!(response.get()).get_value(), 101.0);
    //
    // println!("PASS");
    //

    Ok(())
  }).expect("top level error");
}

